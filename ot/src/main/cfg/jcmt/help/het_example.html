<!DOCTYPE html>
<html>
<head>
    <title>Preparing Heterodyne Observations</title>
    <link rel="stylesheet" href="ot_help.css" type="text/css" />
</head>
<body>

<nav>
<a href="index.html">&#x2190; JCMT OT Primer Main Page</a>
</nav>

<h1>Preparing Heterodyne Observations</h1>

<h2 id="contents">Contents</h2>

<ul>
    <li><a href="#het_info">General Information</a></li>
    <li><a href="#het_start">Getting Started</a></li>
    <li><a href="#het_anat">Worked Example: Beam-Switched Stare MSB</a>
        <ul>
            <li><a href="#het_thsc">The &ldquo;Het Setup&rdquo; Component</a></li>
            <li><a href="#het_rcpe">The &ldquo;DR Recipe&rdquo; Component</a></li>
            <li>
                <a href="#het_tcc">The Target Information Component</a>
                <ul>
                    <li><a href="#het_tinfo">Target Information</a></li>
                    <li><a href="#het_rinfo">Reference Information</a></li>
                    <li><a href="#Moving_Objects">Moving objects</a></li>
                    <li><a href="#Proper_Motion">Allowing for Proper Motion</a></li>
                </ul>
            </li>
            <li><a href="#het_tfoc">The Observation Component</a></li>
            <li><a href="#het_tci">The Chop Iterator</a></li>
            <li><a href="#het_offset">The Offset Iterator</a></li>
            <li><a href="#het_sample">The Stare Eye</a></li>
            <li><a href="#het_time">The Repeat Iterator</a></li>
        </ul>
    </li>
    <li><a href="#het_inttime">Integration Time in General</a></li>
    <li><a href="#het_summary">Summary: Making your Heterodyne MSB</a></li>
    <li><a href="#het_msblib">The Heterodyne MSB Library</a>
        <ul>
            <li><a href="#het_centering">Centering the Observations</a></li>
            <li><a href="#het_shared">Shared or Separate Offs</a></li>
            <li><a href="#het_sam_folder">Single Position Stares</a></li>
            <li><a href="#het_grid_folder">Grid Maps</a></li>
            <li><a href="#het_jig_folder">Jiggle Maps</a></li>
            <li><a href="#het_rast_folder">Rasters &mdash; Classical (scan) &amp; Rasters &mdash; Basket Weave</a></li>
        </ul>
    </li>
    <li><a href="#het_adv">Advanced Heterodyne Topics</a>
        <ul>
            <li><a href="#het_freq_ed">The Frequency Editor</a></li>
            <li><a href="#het_tpe">The Position Editor</a></li>
            <li><a href="#velocities">Velocities: The Het Setup and Target Component</a></li>
            <li><a href="#het_cal">Calibrations</a></li>
            <li><a href="#het_rotator">Rotator Angles</a></li>
        </ul>
    </li>
</ul>



<h2 id="het_info">General Information</h2>

<p>
A detailed description of the various observing modes, RMS noise,
and durations is available at the following web page:
<a href="http://www.eaobservatory.org/jcmt/instrumentation/heterodyne/observing-modes/">Heterodyne Observing Modes</a>.
</p>

<p><i>Even though the information is not required in order to set up a science
program, experienced as well as novice JCMT observers are encouraged
to read the document as general background information.</i>
</p>

<p>
If after reading this guide you have any questions about preparing
your observations, please consult with your "Friend of the Project",
or email <a href="mailto:jcmtot@eaobservatory.org">jcmtot@eaobservatory.org</a>.
</p>



<h2 id="het_start">Getting Started</h2>

<p>
To open up the heterodyne library go to the JCMT OT root window
"File" menu
and click on &ldquo;Open ACSIS library&rdquo;:
</p>


<p>
<img src="het_images/het_library.png" alt="Contents of the heterodyne library" width="289" height="275" class="figure" />
</p>


<p>
A window will pop up containing a list of folders. It is from this
library that we can copy MSBs to be used in our program.
For more information, please see the
<a href="generic.html#lib-acsis">ACSIS Library section</a>.
<p>


<h2 id="het_anat">Worked Example: Beam-Switched Stare MSB</h2>

<p> This chapter will run through an example MSB. First open the folder titled
"Stares" within the <a href="generic.html#lib-acsis">ACSIS Library</a>.
Once that folder has expanded select the MSB labeled
"Beam-switch stare (1X) " and click "Copy" on the toolbar.
</p>

<p>
Now go back to your <a href="generic.html#ysp">science program</a> window,
and click on "Paste". The MSB will be dropped into your science program.
Remember you can save your
progress using the "<a href="generic.html#syp">File&#x2192;Save</a>"
menu option in your science program window.
</p>

<p>
<img src="het_images/het_elements.jpeg" alt="Inside an MSB" width="841" height="697" class="figure" />
</p>

<p>
Click on the title of the MSB. This will activate the MSB
editor panel on the right section of your window.
The properties of an MSB are very simple:
</p>

<ul>
    <li>
        <p>
        It has a title, at the moment "Beam-switch stare".  When
        preparing your own MSB, this title should be changed to something
        meaningful describing the observation, usually with target
        name. Examples might be "B/SW observation of OMC1" or "3 point grid of
        M83". <strong>Please</strong> take the time to do this &mdash; it really
        helps the person doing the observing.
        </p>
    </li>

    <li>
        <p>
        A pull down menu with an Observe counter. Leave that to 1 for the
        time being.
        </p>
    </li>

    <li>
        <p>
        The priority of the MSB. Note that this only affects the internal
        priority of your MSBs &mdash; not the priority allocated to your entire
        project by the TAC. So if you had two different MSBs that rose to the
        top of the scheduling queue and one had priority "1" and the other
        "99", the one marked "1" will normally be observed first. If all your
        MSBs are of equal interest to you, just don't bother changing the
        default.
        </p>

        <p>
        Bear in mind though that MSB selection is an operational
        decision &mdash; marking your MSBs with priorities 1, 2, 3 etc. is no
        guarantee that they will be done in precisely that
        order. For example, your lower-priority MSBs could be done because
        they are observable at a time of day where there is not much else in
        the queue, whereas your high-priority MSBs could be competing against
        the top-ranked project. Also, the observer / telescope operator may sometimes select a
        lower priority MSB because it is the most efficient choice at the
        time, for example because of its duration or position on the sky.
        </p>
    </li>
    <li>
        <p>
        An estimate of how long the MSB will take to observe is also displayed.
        </p>
    </li>
</ul>


<p>
Before moving on you should also be able to complete the
<a href="generic.html#note">note component</a> and the
<a href="generic.html#siteq">site quality component</a>
which is described further in the
<a href="generic.html">Creating Your Program</a> chapter.
</p>

<h3 id="het_thsc">The &ldquo;Het Setup&rdquo; Component</h3>

<p>
If you click on the "Het Setup" component you will see the window
below. The purpose of this component is to configurate
the required heterodyne instrument (the &lsquo;front end&rsquo;) and ACSIS
(the &lsquo;back end&rsquo;) for your observation.
</p>

<p>
<img src="het_images/het_het_setup.png" alt="Het Setup component" width="997" height="645" class="figure" />
</p>

<h4>Front End Configuration</h4>

<ul>
    <li>
        <p>
        The first item in the "Het Setup" component enables you to
        choose the required receiver or <b>Front End</b>. The tuning/frequency
        range over which the selected receiver can be tuned is displayed in
        the <b>Front End Summary</b> box in the top-right corner.
        </p>

        <ul><li>
        Currently only receivers A3m and HARP are available for use.
        </li></ul>
    </li>

    <li>
        <p>
        The <b>Sp.(ectral) regions</b> box allows the selection of
        multiple spectral windows. Multiple spectral regions are especially
        useful if you wish to observe simultaneously two to four spectral
        lines which lie within the same 1.8&nbsp;GHz pass-band,
        e.g. H2D+ at 372.4&nbsp;GHz
        and N2H+ at 372.67&nbsp;GHz.  Commonly used line combinations and
        configurations are listed in the
        <a href="./het_sp_config.html"><b>Special Config(uration)s</b></a>
        pull-down menu to the right, and are described
        <a href="./het_sp_config.html">here</a>.
        If the configuration you wish
        is not in the list, you can create your own using the
        <a href="#het_freq_ed"><b>Frequency Editor</b></a> described
        <a href="#het_freq_ed">below</a>.
        The <a href="#het_freq_ed"><b>Frequency Editor</b></a> tool is shown and
        hidden using the buttons further down the window.  Also, please send a
        message to your "Friend of the Project"
        so we can perhaps add this configuration to the list in
        the OT.
        </p>
    </li>

    <li>
        <p>
        The <b>Bandwidths</b> menu item allows the selection of the
        required bandwidth (in MHz) for each Spectral Region. The resulting
        spectral resolution (in kHz) is automatically updated in the
        "res" entry in the Frequency Configuration table at the bottom of the
        "Het Setup" panel.
        </p>
    </li>

    <li>
        <p>
        The <b>Mode</b> box allows a choice between double sideband (DSB)
        and single sideband (SSB) operation. Note that only Receiver W allows
        a choice between SSB and DSB: Receiver A is a DSB receiver and HARP
        an SSB receiver.
        </p>
    </li>

    <li>
        <p>
        The <b>Sideband</b> menu allows the choice of sideband. Sideband
        suppression is not absolute in the SSB receivers, so the user should
        avoid, if possible, the situation where the unwanted sideband
        corresponds to a frequency where the zenith opacity or receiver noise
        is high.

        <p>
        In most cases, however, you could simply select "best".
        Note that when "best" is selected, the OT will assume
        USB operation, but the determination of which sideband
        is best will be made at the telescope when the observation
        is performed.
        </p>
    </li>
</ul>

<h4>Frequency Setup</h4>

<p>
Tuning of the receiver requires a rest frequency and a velocity.  If
the aim is to observe a specific molecular transition,
you should use
the pull-down lists of <b>molecules</b> and <b>transitions</b> to
generate the frequency.  (If the particular line/transition you are
interested in is not in the list, please send an email to <a
href="mailto:jcmtot@eaobservatory.org">jcmtot@eaobservatory.org</a> so
that the line can be added for the next release.)
</p>

<p>
In the example above the CO (3-2) line has been selected.
Alternately, the
tuning frequency may be specified explicitly in GHz. The frequency
will appear in <span style="color: red; font-weight: bold;">RED</span> until the
<b>Accept</b> button is clicked. <i>This is essential to ensure
acceptance of the input</i>. This method will also result in the
phrase 'No line' appearing in the molecule and transition fields, even
if the frequency does in fact correspond to a known
transition. (Look-up occurs from molecule/transition to frequency only
&mdash; no look-up is done in the opposite direction).
</p>


<p>
The example below
shows a <a href="het_sp_config.html">special configuration</a>
(HARP_H2DN2H_250X2) with the H2D+ 1(1 0 0)-1(1 1 0) transition at
372.4&nbsp;GHz, and the N2H+ 4-3 transition at 372.7&nbsp;GHz, both using the
250&nbsp;MHz bandwidth mode, observed simultaneously.
</p>

<p>
<img src="het_images/het_het_setup2.png" alt="Het Setup component" width="803" height="644" class="figure" />
</p>





<p>
The velocity of the target may be entered either here or in the
<a href="#het_tcc">Target Information</a> component; this second option
is activated by ticking the box marked <b>Default tuning velocity to
target velocity</b>.  If entering the velocity here you must also
specify the <b>Velocity Definition</b> and <b>Velocity Frame</b> from
the two pull-down menus, and click the "Accept" button (to the right
of the frequency field).  (Note that the velocity will appear in
<span style="color: red; font-weight: bold;">RED</span> until you click on the Accept button.
Failure to click on the Accept button will mean the velocity you
entered will be lost.)
</p>

<p>
If your source has a very large radial velocity, you should:
</p>

<ul>
    <li>
        <p>
        Select the receiver within whose tuning range the (red-shifted)
        line will fall.  For example, at a redshift of 2.0, the neutral
        carbon [CI] J=2-1 line, whose rest frequency is 809&nbsp;GHz, will fall
        into the tuning range of Receiver A.
        </p>
    </li>

    <li>
        <p>
        Specify the radial velocity of the source, as above, either in
        the "Het. Setup" velocity field, or in the "Target Information"
        velocity field.  (If you choose the latter, make sure the "Target
        Information" component is at the same level as the "Het. Setup" component,
        and not embedded in the observation sequence.)  If you enter the
        velocity in the "Het. Setup" component, be sure to click the
        "Accept" button before proceeding.
        </p>
    </li>

    <li>
        <p>
        The OT now corrects its look up table of transitions for the
        entered velocity.  Select a molecule and transition from the
        pull-down menu, or enter the <b>rest</b> frequency of the spectral
        line (and click the "Accept" button).  Beware, however, that if you
        enter a value manually into the frequency field, the OT will not
        check to see if the red-shifted line is in the tuning range of the
        receiver you selected.
        </p>
    </li>
</ul>

<p>
For the majority of users this window will provide enough
information/options to set up an observation. In rare cases
&mdash; when trying to configure the backend for multiple lines,
multiple resolution windows, etc. &mdash; you may need to use the
<a href="#het_freq_ed">Frequency Editor</a>
</p>


<h3 id="het_rcpe">The &ldquo;DR Recipe&rdquo; Component</h3>

<p>
With the rapid data acquisition rates now afforded by HARP and
ACSIS, reducing data by hand has become a very slow and
tedious process.  Automatic data reduction pipelines have
become a powerful tool for carrying out these repetitive
tasks.  ORAC-DR has been developed for reducing and combining
JCMT data, primarily for producing "preview"
images for assessing data quality at the telescope, but it can
also be used for the final reduction.
It is used to generate reduced data products
for the <a href="http://www.eaobservatory.org/jcmt/science/archive/">JCMT Science Archive</a>,
so the configuration chosen here is important because it
will affect the quality of these products in the archive.
The reduced products will be made available to you through
the archive within a day or two of each MSB being observed.
</p>

<p>
The "DR Recipe" component is used to specify the
<a href="http://starlink.eao.hawaii.edu/devdocs/sc20.htx/sc20ch9.html#x10-760001">
recipe that is to be used by ORAC-DR</a> for reducing the data.
ORAC-DR uses recipes to carry out all
the usual reduction steps that were once carried out by
hand.  Note that these recipes are <i>still under
development</i> and thus are likely to change and evolve.
The example in the figure below shows the "DR Recipe" component
positioned underneath
the "Het Setup" component, although it need not be positioned
exactly here.  (Note that the "DR Recipe" component needs to be
paired with a "Het Setup" component, however.)  Open the
DR Recipe component by clicking on it.  The bottom portion of
the window displays a list of the available recipes, with a
very short description of each.  (See below for a fuller
description.)  Click on the desired recipe, then click the
"Set" button in the top portion of the window corresponding
to the desired observing mode.
</p>

<p>
<img src="het_images/het_drrecipe.png" alt="DRRecipe elements" width="1011" height="695" class="figure" />
</p>


<p>
Recipe names primarily reflect the method used for fitting a
baseline, since how this step is carried out differs
depending on the line profile(s) expected.  Effectively the
recipe chosen tells the fitting routine how to deal with
baseline features. To illustrate this imagine a narrow spike
on a broad profile: this can be a narrow line on a broad
baseline wiggle, a noise spike on a broad line, or a core
plus outflow profile. This process is tricky in this sense:
the baseline fitting can easily remove a feature of interest
from the preview image. Observers should <em>always</em> go back and
inspect the raw data carefully to assess the accuracy of the
preview images and pipeline reduction. For more information
please see the <a href="http://starlink.eao.hawaii.edu/devdocs/sc20.htx/sc20.html">
Heterodyne Data Reduction Cookbook</a>.
</p>

<p>
Note that for all observations the outer ~5% of channels on either
side typically are too noisy to be useful and are excluded
from the reduction described below. Typically, smoothing and
clump-finding algorithms are used to exclude emission-free
regions from the total intensity and intensity weighted
velocity collapses. These moments maps are thus derived
based on the line widths of each spectrum. The exact methods
differ from recipe to recipe and are still under
investigation and development. Specifically the is aim to
provide the observer with useful preview images that are
representative of their data.
</p>

<p>
The following standard reduction recipes are currently being
developed for use with the ORAC-DR pipeline, with an emphasis
on scan-map data. An outline is provided below, but expect
changes and redesigns as we gain experience. The main
purpose of the routines is to
</p>

<ol>
<li>fit a baseline to the spectra and
<li>select emission from the background
</ol>

<p>
before collapsing the cube into e.g. total intensity and
intensity weighted velocity images.
</p>

<dl>
    <dt>reduce_science_gradient</dt>
    <dd>
        <p>
        Intended for nearby galaxies and sources which
        have a significant velocity gradient (rotation) across
        the field of view.   Assumes line widths in excess of
        25 channels (~10 km/s @ BW=1000MHz and ~1 km/s @
        BW=250MHz). Baseline regions are determined for each
        spectrum individually.
        </p>
    </dd>

    <dt>reduce_science_broadline</dt>
    <dd>
        <p>
        Intended for extragalactic and other sources with very wide
        lines. Linear baselines are fitted to the outer 1/6 of
        the spectral range of the co-added cube (after
        truncating the outermost ~5% of the channels on each
        end). The integrated intensity and intensity weighted
        velocity map are derived from the inner 2/3 of the
        spectral range.
        </p>
    </dd>

    <dt>reduce_science_narrowline</dt>
    <dd>
        <p>
        Intended for Galactic sources with not much of a velocity
        gradient across the field of view. Baseline regions
        are determined from a global average spectrum. This
        single set of regions is used to fit the baseline for
        all spectra in the cubes.
        </p>
    </dd>

    <dt>reduce_science_lineforest</dt>
    <dd>
        <p>
        Intended for spectral-line surveys, or where multiple
        (narrow) spectral lines are expected within the
        spectral range.
        </p>
    </dd>

    <dt>reduce_science_continuum</dt>
    <dd>
        <p>
        Intended for continuum sources, or for absorption
        line spectra  in front of a continuum source.  No
        baseline subtraction is done.
        </p>
    </dd>
</dl>



<h3 id="het_tcc">The Target Information Component</h3>

<p><b>WARNING:</b> Positions of
astronomical objects are often wavelength-dependent. For example, the
SIMBAD coordinates for IRAS16293-2224 are many arc-minutes different
from the JCMT coordinates. The catalogs you may be using will
have defined the astrometric positions therein on the basis of
optical or infrared or radio observations. You should check that
the positions now showing are valid for your sub-millimeter studies.
</p>

<p>
Click on the "Target Information" component to bring up its panel:
</p>

<p>
<img src="het_images/het_target.png" alt="The Target component" width="934" height="695" class="figure" />
</p>


<h4 id="het_tinfo">Target Information</h4>


<p>
In this component you will enter the coordinates and velocity/redshift of
the source, and the coordinates of the reference position (for
position-switched observations).  The "Target Type" is a pull-down
menu that allows you to select RA/Dec (most common), Orbital Elements
(for comets, etc.), or a Named Planet.  The window changes for each
selection.  For RA/Dec targets, enter the R.A. and Dec. in the
appropriate boxes, using colons as separators.  One of several
different coordinate systems can be selected with another pull-down
menu, such as J2000, B1950, etc.
</p>

<p>
It is recommended that you specify the radial velocity of the
source in the target component, either as a radio, optical, or
relativistic velocity, or redshift (z).  Note that if a velocity is
specified in the <a href="#het_thsc">"Het. Setup"</a> component, this
overrides velocities specified in the target component.
</p>



<p>
Instead of entering the source coordinates manually, you can
search for them via the internet. Assuming you have an internet connection
you can enter the name of your target, select the on-line catalog to
search (i.e. SIMBAD or NED) from the pull-down menu, and click "Resolve
Name". After a brief pause the RA and DEC co-ordinate fields should
become populated with the SIMBAD/NED co-ordinates for the source. The
SIMBAD/NED name for the source will also be indicated next to the
"Resolve Name" button.
</p>


<h4 id="het_rinfo">Reference Information</h4>

<p>
The above example is a beam-switched observation where the
subtraction of background sky emission uses a nearby "off" position
which is observed by "chopping" with the telescope's secondary mirror.
(Please see the <a href="#het_tci">Chop Iterator</a> section for more information.)
This is also the case for the jiggle-chop and jiggle-chop
offset MSBs available in the
<a href="generic.html#lib-acsis">ACSIS Library</a>.
All other MSBs require the selection of a reference position.

<p>
To specify a reference position, click on "REFERENCE".
The default is to enter an absolute position for the reference.
</p>

<p>
<img src="het_images/het_target-ref1.png" alt="The Reference component" width="809" height="620" class="figure" />
</p>


<p>
By checking the "Offset" box, you can enter the offset
(in arc-seconds) from the source position
</p>

<p>
<img src="het_images/het_target-ref2.png" alt="The Reference component" width="817" height="603" class="figure" />
</p>

<p>
<b><i>NOTE: the reference position is required for
position-switched observations as the location for the sky reference. If
present in beam-switched observations, the three-load calibration will
be carried out at that location.</i></b>
</p>



<h4 id="Moving_Objects">Moving Objects</h4>

<p>
Moving objects (except planets and other bodies which are accessible
in the pull down menu in the Target component) are accommodated via
the Orbital Elements choice in the drop down menu. The format of these
elements is fairly specific. An example is given in the figure below.
</p>

<p class="figure">
<b>Comet Tempel-1: orbital elements</b>
<br />
<img alt="Orbital elements from the NEO site" src="images/orbitelements1.png" width="485" height="464" />
<br />
<img alt="Equivalent in the target component" src="images/orbitelements2.png" width="669" height="211" />
<br />
<b>Top:</b>
Orbital elements as found, in this example, on the
<a href="http://neo.jpl.nasa.gov/orbits/">NASA JPL NEO orbit diagrams page</a>
<br />
<b>Bottom:</b>
Elements specified in the Target Component Elements tab.
Note the different format for Epoch and Time of Perihelion Passage, in
particular.
</p>

<p>
The OT can use the Horizons database to resolve a given minor planet's
name into elements. An example is given below.
</p>

<p class="figure">
<img src="images/target_elements1.png" width="1021" height="695" alt="screen shot" />
<br />
<b>Name resolution for moving objects:</b>
When "Orbital elements" is the selected Target Type, the "Resolve name"
button queries the Horizons database for elements.
</p>

<p>
Note that the name format is somewhat picky and you may have to use
trial and error to get something that works for a particular target.
Also note that the OT uses a resource at JPL which is intended for
human reading, not computer processing. As such the output format is
subject to arbitrary changes, so there is no guarantee that this search
feature will work or that the results are accurate; for example it is
possible that elements may end up in the wrong field or omitted
completely. <b><i>Always double check the returned values.</i></b>
</p>

<h4 id="Proper_Motion">Allowing for Proper Motion</h4>

<p>
Entries for the RA and Declination proper motion rates (in
milli arc-seconds per year) can be made in your target component.
</p>

<p class="figure">
<img width="442" height="127" src="images/target_propermotion.png" alt="screen shot" />
<br />
<b>Proper motion</b>
entered as milli arc-seconds per year in the target
component. These values are taken into account when slewing the
telescope.
</p>




<h3 id="het_tfoc">The Observation Component</h3>

<p>
Now click on the Observation component to bring up its panel. If you
recursively open all of the toggle switches, the individual components
will be displayed as a hierarchy, as shown below.
</p>

<p>
<img src="het_images/obs_comp.png" alt="Observation component" width="934" height="695" class="figure" />
</p>


<p>
Inside the Science Observation component we see a sequence iterator.
The sequence iterator doesn't do anything <i>per se</i>, but it is
important to note that it represents the sequence of events at the
telescope. The sequence iterator contains a repeat iterator, then
(depending upon the observation type) perhaps a chop iterator or an
offset iterator &mdash; a position-switched grid around the target,
and finally a single action with an "eye" symbol.
The repeat iterator allows
the user to control the number of repeats carried out for a certain
observation, within a single instance of the MSB
&mdash; this extends the duration of the MSB and you should
ensure it does not become excessively long.
(If you wish to observe the whole MSB multiple times,
you should use the "Observe" counter instead
as described in the <a href="generic.html#thingies">Components</a> section.)
</p>

<p>
The "Flag as calibration" box should be ticked if
this observation is intended as a calibration for other observations.
This fact is then made known to the telescope operator who may decide not to
execute the observation if a suitable
calibration has recently been done already. In most cases this
will not be required.
</p>

<p>
The Science Observation component also tells us how long the entire
sequence will take to execute. This is an important component to
check when we are creating our program, remembering our rule for
the <a href="intro.html#MSB">length of a MSB</a>.
</p>

<p>
In the case of a position-switched basket weave, we have two "Scan"
components under the sequence iterator. These observations
typically do not require additional repeats, and they use a
reference position rather than a chop. For more information
on basket weave observations please see the <a href="#het_rast_folder">Raster
section</a> (which includes
the classical raster scan and the basket weave raster scan.
</p>

<p>
<img src="het_images/obs_comp-raster.png" alt="Observation component for a raster" width="934" height="695" class="figure" />
</p>




<h3 id="het_tci">The Chop Iterator</h3>


<p>
The chop iterator &mdash; used to remove background sky emission &mdash;
has a list of chop configurations.
The example below has one 60 arc-second chop.
Each chop configuration is specified by a
throw (the chop distance), an angle on the sky
and the co-ordinate frame of that angle.
In this example
the frame is AZEL (Azimuth/Elevation) but other common options are
TRACKING (RA &amp; Dec if the target is specified in those coordinates)
or FPLANE (Focal Plane).
</p>

<p>
<img src="het_images/het_chop.png" alt="The Chop Iterator" width="934" height="695" class="figure" />
</p>


<p>
A 60 arc-second chop with
an angle of 90 degrees AZEL (i.e. 60 arc-second in the azimuth direction)
is typical for beam switched observations of compact sources. If the
source is extended, one might want to increase the chop throw, or if
the source was elongated in one direction on the sky, chop in a
rotated direction relative to the RA/DEC frame.
</p>

<p>
<b>The maximum recommended chop throw is 180 arc-seconds.</b>
There is a software limit of 240 arc-seconds.
Chopping with large throws is less efficient than using
small throws and also there will be a slight distortion of the beam
due to observing off axis.
By clicking on "Add" you can add chop
configurations. Each configuration will result in a separate
observation.
</p>

<h3 id="het_offset">The Offset Iterator</h3>

<p>
It's often very useful to be able to specify a position with the
<a href="#het_tcc">Target component</a>, but to take an observation at a
position offset from that specified.  That can be done with the
"offset" iterator.  In addition, with
<a href="#het_grid_folder">Grid maps</a>,
a whole series of offsets can be specified in either a
regular or irregular spacing.
</p>


<p>
The following example has been made by going to the
<a href="generic.html#lib-acsis">ACSIS Library</a> and
copying a "Position-switch grid" MSB from the "Grids" folder into
a new program.
</p>

<p>
<img src="het_images/het_offset1.png" alt="The Offset Iterator (1)" width="934" height="695" class="figure" />
</p>

<p>
If an offset iterator is not already specified in the MSB, you can
insert it below the "Sequence" iterator
usually just above the stare icon.
Click on the iterator below which the offset iterator is to be inserted (the
"Repeat" iterator in the image above), then click on the iterator menu
on the left-hand panel of the OT window and select the offset
iterator.  Be sure to "drag" the stare icon to the right, so
that it is indented with respect to the offset iterator
(as in the figure above).
</p>

<p>
The offset is specified in arc-seconds in the "p" and "q" boxes.  Note
the orientation of these axes to the left of the "Title" box.  In an
unrotated frame, "p" is in the positive R.A. direction (i.e. east)
while "q" is in the declination direction (i.e. north).  If a rotated
frame is required, enter the position angle (measured east of north)
in the "PA" box.  If you then click on the "Display Derotated Offsets"
button, the specified offsets in the unrotated frame will be briefly
displayed in the table above.
</p>

<p>
To add more offsets, click the "New" button, and enter the offset in
the "p" and "q" boxes as above.  Repeat for as many positions as
required.
</p>

<p>
A regular grid can also be specified using the "Grid Pattern" section
of the window.  See the section on
<a href="#het_grid_folder">Grid Maps</a> for a description.
Note that all offsets at the JCMT are
defined in the Gnomonic (TAN) projection.
</p>

<h2 id="het_sample">The Stare Eye</h2>

<p>
The science observation itself is represented within the MSB by the
"Stare" eye or (in the case of <a href="#rxa_rast_example">classical
and basket weave rasters</a>) a "Scan" eye. Click
on it to display the details of the
observation. The pull down menu near the top of the right hand frame
allows you to choose between beam switching and position switching.
In this example we are beam switching and the chop throw was set with
the <a href="#het_tci">Chop Iterator</a>.  In the "Secs per offset
sample" box, enter the <b>total on-source integration time</b> per
sample position in seconds.
</p>

<p>
The estimated RMS noise per channel is shown in the "Noise" box.
Typical recommended on-source integration times per sample are 5 to
15 minutes. We advise to keep observing times under 15-20 minutes,
at the risk of loosing observations when something goes wrong. Longer
observations do have risk associated with them however they are more
efficient, requiring fewer instrument set ups over longer periods of time.
</p>



<p>
<img src="het_images/het_eye.png" alt="The stare eye" width="976" height="718" class="figure" />
</p>

<p>
The "Continuum Mode" box can be checked if you need an accurate
measurement of the continuum level. Typically this only makes sense
when doing a beam-switched observation, because the switching time for position-switched
observations are too long for a reliable determination of the
continuum. For beam-switched observations, the effect of checking "Continuum
mode" is to run the chopper much faster. This will result in higher
overheads which can significantly increase the time it takes for the
observation to complete. Hence, this mode should only be used when
really needed. As a concrete example: the maximum time between chops
typically allows for the completion of a full 9x9 jiggle with 0.1sec
step, i.e. 8.1 secs. The chopper will then spend ~3 secs in the
off-position, resulting in an 11-sec cycle plus some overhead. In
continuum mode the chopper will move to the reference every 0.1secs
and spend equal times in the 'on' and 'ref' position. A 9x9 jiggle will
thus take 16.2 secs plus significantly more overheads due to transit
times of the chopper. Limited testing so far suggests that the typical
penalty for using continuum mode is an increase of the observing time
by a factor of 1.7.
</p>

<h3 id="het_time">The Repeat Iterator</h3>

<p>
The Repeat iterator's only property is a repeat counter. This repeat
counter will affect things that are <strong>inside</strong>
the repeat iterator (i.e. indented under it) in turn. So if you set it
to 2, your science observation consist of two spectral line stares;
i.e you will end up with precisely two spectral line observations.
</p>

<p>
<img src="het_images/het_repeat.png" alt="The Repeat Iterator" width="976" height="718" class="figure" />
</p>

<p>
If you require a long integration of a source, it makes sense to break
the observation down into shorter integrations of around 10 minutes
or so, so that data quality can be assessed as the observation
progresses. It also ensures that if the observation fails intermediate
data is written out and not lost.
</p>


<h2 id="het_inttime">Integration Time in General</h2>


<p>
In practice, you set up the integration time required per
spectral line observation using the stare or scan eye. If you
selected the stare you should use the
repeat iterator to define a sufficient number of repeats to give the
total required integration time for the MSB - typically we recommend between
<a href="intro.html#MSB">30 to 70 minutes</a>. Shorter observations are
recommended for ease of scheduling in a flexible queue.
</p>

<p>
The <b>total</b> time spent on source is then a <i>X</i> times then length
of one MSB where <i>X</i> is the <a href="generic.html#thingies">observe counter</a>
value which can be specified in the top level of the MSB.
</p>

<p>
Now you can see how your time usage builds up. Working our way inside
out (and bottom to top):
</p>

<ul class="custom_marker">
    <li>
        <p>
        <img src="images/icon_eye.png" alt="*" width="18" height="18" />
        The stare
        eye is set to an on-source integration time (and shows you the
        estimated RMS noise).
        </p>
    </li>

    <li>
        <p>
        <img src="images/icon_iterator.png" alt="*" width="16" height="16" />
        The Repeat
        iterator multiplies the number of times the stare is carried
        out. If you increase it from the default of 1, don't forget to
        take that into account when calculating how deep you will go.
        </p>
    </li>

    <li>
        <p>
        <img src="images/icon_observation.png" alt="*" width="16" height="16" />
        The observation
        component shows you the estimated time of the sequence it
        contains.
        </p>
    </li>

    <li>
        <p>
        <img src="images/icon_msb.png" alt="*" width="16" height="16" />
        The MSB component will give
        you the estimated time of the observations inside it. For the
        heterodyne OT, you only need to define MSBs for your science
        observations. Obviously, before the observation, the telescope operator will tune the
        receiver (when necessary), focus the telescope, and do a pointing
        observation. Specific calibration instructions, for example, the
        observation of a spectral line standard and/or a planet should be
        described in the note attached to the MSB. Be sure to remember to
        click the "Show to Observer" tick box for the note. In conclusion, the
        estimated time for an MSB only includes observations of the science
        target &mdash; one should remember there will be instrument set up and
        calibration overheads on top of this when planning your observing
        program.
        </p>
    </li>

    <li>
        <p>
        <img src="images/sci_prog.png" alt="*" width="17" height="16" />
        The Science Program will
        give you the estimated time of all MSBs inside it including the number
        of repeats. So if you have a 1hr MSB (as in this example) and you set
        the MSB counter to 2, your MSB estimated time will be 1hr and your
        Science Program time will show 2hrs.  Remember that different MSBs may
        be observed on different nights, whereas observations within a single
        MSB will be observed within a single night.
        </p>
    </li>
</ul>


<h2 id="het_summary">Summary: Making your Heterodyne MSB</h2>

<p>
So far, the various elements of the MSB have been described. We now
summarize the general procedure for making your own.
</p>

<ul>
    <li>
        <p>
        Choose the corresponding MSB template from the heterodyne library and
        copy/paste it to your science program.  Each of these is described
        briefly <a href="#het_msblib">below</a>.
        </p>
    </li>
    <li>
        <p>
        Fill out the "Het Setup" component with the frontend/backend details
        for your observation.
        </p>
    </li>
    <li>
        <p>
        Set up the "Site Quality" component, normally this means simply leaving
        the "allocated" button selected.
        </p>
    </li>
    <li>
        <p>
        Enter the target information for your target. This step can be as
        simple as entering the RA/DEC and epoch. Don't forget
        that the name resolver and the position editor
        can help you out here.
        </p>
    </li>
    <li>
        <p>
        Set up the "DR Recipe" component accordingly. Remember the component is used
        to specify the  <a href="http://starlink.eao.hawaii.edu/devdocs/sc20.htx/sc20ch9.html#x10-760001">
        recipe that is to be used by ORAC-DR</a> for reducing the data.
        </p>
    </li>
    <li>
        <p>
        Set up the chop or offset iterator if appropriate.
        Again this can simply mean entering the
        chop throw angle and reference frame, or this iterator can be set up
        via the <a href="#het_tpe">position editor</a>.
        </p>
    </li>
    <li>
        Set up the your total integration time for your target.
        This will be a combination of the following:
        <ul>
            <li>
                <p>
                The "Stare" eye &mdash; remember to enter the total
                on-source integration time per sample.
                </p>
            </li>
            <li>
                <p>
                The <a href="#het_time">repeat counter</a>
                to give the number of repeats of the
                time set up in the stare eye to get your total required
                integration time in a <em>single</em> observation/MSB.
                </p>
                <p>
                It is encouraged that MSBs are 30-70 minutes in length.
                If you want a total observation integration of 30 minutes
                on-source (per MSB), you should set up an integration time of 5 minutes in
                the stare eye and set the repeat counter to 6. When
                observing, you can then monitor the observation by inspecting the
                data file produced every ~13 minutes, and co-add the spectra as
                you go along. In general, if you want to build up long
                integrations, you will want the duration of the basic observation
                to be of the order 10 minutes <em>("on+off+overheads")</em>.
                </p>
            </li>
            <li>
                <p>
                Set the <a href="generic.html#thingies">MSB Observe counter</a> to
                build up to your <em>total</em> integration time. You may want the
                duration of the basic observation to be of the order 10
                minutes and an MSB to last 30-70 minutes but you might be
                requiring a total time on source of ten hours.
                </p>
            </li>
        </ul>
    </li>
    <li>
        <p>
        Add at least one <a href="generic.html#note">"Show to Observer" note</a>.
        This should contain
        additional information on the overall aims of your science
        program, details of required calibrations and any other special
        notices you want the observer and telescope operator to act upon when the
        observation is made.
        </p>
    </li>
    <li>
        <p>
        Click on the outermost level of the MSB. In the right hand panel
        you should give the MSB a meaningful name. Be aware that
        observers and operator typically will see only the start of that
        line in the browsing tool, hence put the most significant
        information at the start. E.g.<br> 'IRC+10216 spectral line
        survey, CO molecule, transition 230.538'<br> 'IRC+10216 spectral
        line survey, CO molecule, transition 220.399'<br> will look
        similar without expanding the name field in the
        browser. Instead<br> 'IRC+10216 230.538, spectral line survey, CO
        molecule'<br> 'IRC+10216 220.399, spectral line survey, CO
        molecule'<br> would be a better compromise.
        </p>
        <p>
        Below the name field, there is pull down menu labeled
        "Observe". This counter allows you to control how many times you
        want the whole MSB observed. If you want it done just once, leave
        this as (1x). You can set the relative priority of the MSB within
        your science program using the "Priority" pull down menu. Set
        this between 1 and 99, with 1 signifying the highest
        priority.
        </p>
    </li>
</ul>

<p>
That's pretty much all you need to know to start preparing your
MSB. The remainder of this primer covers the Heterodyne MSB library
and advanced topics.
</p>

<h2 id="het_msblib">The Heterodyne MSB Library</h2>

<p>
The heterodyne library groups the MSB templates according to whether
the observation is to be a Stare, a Grid, a Jiggle-Chop, or a
Scan-PSSW:
</p>

<dl>
    <dt><a href="#het_sam_folder">Single-position Stare</a></dt>
    <dd>
        <p>
        This is
        the most fundamental of the observing modes, in being a single spectrum
        observed toward at a single position. The stare can either use a
        position switch (<em>Stare-PSSW</em>) or a beam switch
        (<em>Stare-BMSW</em>).  PSSW observations typically spend of order 30
        secs on the source before going to the reference position for 30 secs,
        but they can accommodate large switches exceeding several degrees.
        BMSW observations by contrast offer a better sky cancellation by
        switching much faster between the source and reference (up to several
        Hertz in "continuum mode"), but are restricted to a switch of 180" at
        the most. Also, the telescope will <em>nod</em>: half the time will be
        spent chopping to one side of the source, half to the other side,
        requiring both sky positions to be free of emission.
        </p>
        <p>
        The offset iterator can be used to observe at a position offset from
        the one specified in the <a href="#het_tcc">Target Component</a>.  If
        you specify multiple offsets these modes will be equivalent to a
        Grid-PSSW or a Jiggle-Chop, although the detailed execution will be
        different in case of the latter (see below).
        </p>
    </dd>

    <dt><a href="#het_grid_folder">Grid</a></dt>
    <dd>
        <p>
        These observations are
        stares carried out at multiple offsets, either in a regular grid or
        as a series of explicit offsets. The observations from each grid point
        end up in a single cube, sharing calibrations and possibly offs. The
        observations at each position can be either position-switched or
        beam-switched.  Position switched patterns are executed as
        OFF-ON(s)-ON(s)-OFF-OFF-...  Grid maps are used where relatively
        small, sparse maps are required with longish integration times per
        point.
        </p>
        <p>
        (Note: it is possible to do a grid of jiggle-maps by putting a
        "Jiggle-Eye" inside an "Offset" iterator. However, in this
        case the jiggles will be executed as fully independent observations at
        each grid point, resulting in independent cubes.)
        </p>
    </dd>

    <dt><a href="#het_jig_folder">Jiggle</a></dt>
    <dd>
        <p>
        This mode makes a small map
        by "jiggling" the secondary mirror rapidly over all the points in the
        map and is similar to Stare-BMSW/Stare-PSSW observations on a
        regular, pre-defined grid, such as a 4x4 pattern.  There is an
        important distinction: rather than fully completing each position
        before going to the next, Jiggles will combine sequences of short
        integrations at all positions and possibly cover the whole jiggle
        pattern many times to build up the integration time at each
        point. Thus, it will typically observe multiple source positions
        before going to the reference position for a relatively longer time,
        although this is configurable through the "Separate offs"
        tick-box.
        </p>
        <p>
        Jiggles are new to heterodyne observing at the JCMT, and specifically
        designed for HARP although useful for single receptor receivers as
        well.
        </p>
    </dd>

    <dt><a href="#het_rast_folder">Rasters &mdash; Classical (scan) &amp; Rasters &mdash; Basket Weave</a></dt>
    <dd>
        <p>
        This mode is useful
        for making large maps rapidly. The telescope continuously takes data
        while scanning across the source in a back-and-forth pattern. It
        will typically go to the reference between rows and an interpolation
        of the references on either side of the row will be used for each of
        the samples in the row. This mode is much more efficient for mapping large
        regions than Grid maps.
        </p>
        <p>
        The primary between the Classical (scan) raster and the Basket Weave
        raster is the double scan component in the Basket Weave. The two scan
        components in the Basket Weave MSBs is to enable two scans in orthogonal
        directions to produce a smoother output map. Basket Weave raster maps are
        used by JCMT users requiring smooth spatial coverage and are thus more common.
        </p>
    </dd>
</dl>

<p>
A detailed description of the various observing modes, RMS noise, and
durations is available as a document
<a href="het_obsmodes.html">Heterodyne Observing Modes</a>.
<i> Even though the information is not required in order to
set up a science program, experienced as well as novice JCMT observers
are encouraged to read the document as a general
background.</i> The discussion below concentrates on the
mode-specific components in the JCMT OT.

<h3 id="het_centering">Centering the Observations</h3>

<p>
RxA and RxW at any time observe only a single position on the sky and
by default the target-position will be centered on the receptor:
they are <i>receptor-centered</i>.
</p>

<p>
For HARP the situation is more complicated. Firstly, it has 16
receptors, each of which in principle can be aligned with the target
position for <i>receptor-centered</i> observations. But secondly, and
more to the point, the 4x4 receptor array does not have a center
receptor. For <i>regular grids or jiggles</i> this results in maps
with even dimensions, such as 16x16. The center of the map will thus
fall between the center four pixels. Since the output pixels are the
locations observed by the receptors, this also means that
center-position of such a map will not have been observed precisely by
any receptor. For fully sampled maps the consequences should not be
significant, but for user-defined sparse grids they can be disastrous
since possibly no receptor may come even close to the target position.
</p>

<p>
Consequently, for HARP there are three possible alignments:
</p>

<dl>
    <dt>Receptor-centered</dt>
    <dd>
        <p>
        The target position is placed on
        one of the center-four receptors. Since these receptors are offset
        (15",15") from the array center, this will result in strongly
        asymmetric maps with the target position displaced 21" towards one of
        the four corners.  Which corner will depend on the elevation of the
        observations, since it depends on which of 4 possible angles,
        differing by 90 degrees, the k-mirror will select. Combining
        <i>receptor-centered</i> observations from different elevations
        <em>may</em> thus result in a wind-mill pattern with spectra from only
        9 of the 16 receptors overlapping in all observations (see figure
        below). For compact targets smaller than the area mapped by a single
        receptor this may still be the observing mode of choice, since the
        whole source will be mapped by a single receptor.  Which of the
        center-four receptors will be the "tracking receptor" is set in a
        telescope configuration file and is in principle not user-configurable.
        All patterns with names like NxN ("3x3", "4x4" etc.) are
        <i>receptor-centered</i>.
        </p>

        <p>
        <img src="het_images/windmill_small.png" alt="HARP windmill" width="284" height="262" class="figure" />
        </p>
    </dd>

    <dt>Array-centered</dt>
    <dd>
        <p>
        The target position is placed in the
        center of the array <i>between</i> the center-four receptors. The
        resulting map will be symmetric around the target position and
        independent of the K-mirror orientation. However, none of the
        receptors will align <em>exactly</em> with the target position, which
        may not be an issue for an extended source, but will probably be a
        serious problem for a sparse grid of a source with a point-like core.
        In case of a fully sampled observation using one of the special HARP
        jiggle patterns this mode is referred to as <b><i>map-centered</i></b> since
        the target position will be between the center-four pixels in the
        output map which will be either 7.5" or 6" apart depending on the
        pattern selected.  The <i>map-centered</i> harp jiggle patterns are
        named "harp4_mc" and "harp5_mc" in the JCMT OT.
        </p>
    </dd>

    <dt>Pixel-centered</dt>
    <dd>
        <p>
        The target position is placed on one
        of the center-four pixels of a jiggle map, slightly offset by half a
        pixel in each direction from the center of the map. This mode is only
        available when using one of the special HARP jiggle patterns and is
        the counter-part to the <i>map-centered</i> observations above.  As is
        the case for the <i>receptor-centered</i> map, discussed above, the
        map will be asymmetric around the target but only by one <em>map
        pixel</em>. A wind-mill pattern resulting from the K-mirror flipping
        by 90 degrees will only affect a 7.5" or 6" rim along the edges of the
        map.  The <i>pixel-centered</i> harp jiggle patterns are named
        "harp4" and "harp5" in the JCMT OT.
        </p>
    </dd>
</dl>

<p>
The figure below illustrates the <i>pixel-centered</i> and
<i>map-centered</i> centering for the HARP jiggles: the cross shows
the location of the target position in the output map. Note that the
HARP4 and HARP5 pattern, shown here offset to the top-left corner, can
be offset to any other corner depending on the elevation of the
observation. For <i>receptor-centered</i> grids the cross would be at
the same location as the middle of the dark-blue postage stamp in the
center of the HARP5 images. Another discussion of the HARP jiggle
patterns can be found
<a href="het_obsmodes.html#jchp_grids"><i>here</i></a>.
</p>

<p>
<img src="het_images/harp_jiggles.png" alt="Jiggle patterns" width="512" height="512" class="figure" />
</p>

<h3 id="het_shared">Shared or Separate Offs</h3>

<p>
The concept of <i>shared</i> or <i>separate offs</i> almost
exclusively applies to jiggle and scan maps.  Offs will also be
shared for position-switched grids with very short integration times
(&le; 15s), but that choice is not user-configurable. <i>Shared
offs</i> are also required for scan maps. However, jiggles can be
configured either with <i>shared</i> or <i>separate offs</i>.
</p>

<p>
<i>Shared offs</i> means that the observations at a number of
positions in the map, i.e. <i>on</i>s, share the sky reference, the
<i>off</i>. This concept originates from traditional scan map
observations where the telescope scans across an extended source
before going to a sky reference. By necessity all positions observed
along the scan will share the same sky reference or <i>off</i>.
Since 50% of the noise observed in a spectrum (i.e. <i>on-off</i>)
results from the <i>off</i> this would lead to severe 'striping' of
successive rows unless the integration time in the <i>off</i> position
is sufficiently increased to drop its noise significantly below the
noise of the <i>on</i> measurements. Calculations show that the
integration time in the <i>off</i> needs to be multiplied with
<i>sqrt(np)</i>, where <i>np</i> is the number of <i>on</i> positions
in the row. Of course, there is nothing special about scan-maps: the
same applies for any observations where a number of points share the
sky reference, as is the case for HARP jiggle-maps where the full 4x4
or 5x5 jiggle pattern is observed before going to the <i>off</i>.
</p>

<p>
Observations benefit from <i>shared offs</i> in two ways and the more
so the more points between the <i>offs</i> (the larger the
scan-map). To illustrate, consider 1s observations of 16 positions
(which would be a very small scan map). <i>Separate offs</i> would
require <b>32s</b> on the sky equally split between <i>ons</i> and
<i>offs</i>. Using <i>shared offs</i> the observation needs only
16+4=<b>20s</b>. But also <b>for each point individually the noise is
reduced</b> because of the longer observation of the
<i>off</i>. Expressed in a time required to reach a particular RMS the
combined effect makes <i>shared off</i> observations <em>4 times</em>
faster than separate observations in the limit of many points. More
precisely, the factor is ~4/(1+2/sqrt(np)) or ~2.7 for the relatively
small HARP jiggle patterns and ignoring fixed overheads (which reduce
the factor to closer to ~2). Nevertheless, one night instead of two
nights is a huge gain, which is why <i>shared offs</i> are the default
for jiggle-chop observations.
</p>

<p>
The figure below shows the benefits in terms of the duration of the
HARP4 jiggle observation, including realistic overheads, needed to
reach a certain RMS (assumed Tsys = 250 K and frequency channels of 1
MHz). Note that <i>shared/separate offs</i> are only relevant within a
single observation, which typically take 10-20 minutes.  The figure
shows that e.g. a 15min observation using <i>shared offs</i>
(<span style="color: blue;">blue line</span>)
will have the same RMS noise as a 33min
observation using <i>separate offs</i>
(<span style="color: red;">red line</span>).
Note that co-adding successive observations will
decrease the noise with the usual sqrt(nr spectra) factor,
irrespective of the shared mode chosen.
</p>

<p>
<img src="het_images/het_compare.png" alt="Figure: Comparing shared and separate offs" width="512" height="371" class="figure" />
</p>

<p>
Of course, <em>the above gain comes at a price</em>: all 16 or 25
jiggle-positions from each receptor are correlated because they have
the same sky reference (<i>off</i>). As long as the pixels are kept
separate this is not an issue because noise remains dominated by the
<i>on</i> measurement and the points can be regarded to be only weakly
correlated. However, any operation in which pixels are combined will
'suffer' from this correlation in the sense that it will combine
pixels that are not fully independent and the noise will hence not
drop with the customary sqrt(np) factor. Note that this both applies
to operations that use a <b><i>spatial convolution (smoothing)</i></b>
as well as <b><i>total flux measurements</i></b> that sum or average
over pixels such as <i>aperture photometry</i>. In the extreme, when
averaging data over the whole footprint of a harp4 observation, the
noise will be 1/4th (16 independent receptors) instead of 1/16th (196
pixels) of the noise per pixel.  Finally: note that jiggle-chop <i>continuum
mode</i> observations always will have <i>separate offs</i>, because
the secondary will chop to the off position faster than it moves
around the jiggle pattern.
</p>

<p>
In conclusion: <b>if imaging or velocity/frequency data are the
primary aim of the observations, <i>shared offs</i> are hugely
beneficial and recommended; if accurate flux measurements over
extended regions are the primary aim or the final maps will be
spatially smoothed significantly, <i>separate offs</i> are
recommended instead.</b>
</p>

<h3 id="het_sam_folder">Single Position Stares</h3>

<p>
A stare denotes an observation consisting of one pointing per science
target. It can be beam-switched (BMSW) or position-switched (PSSW).
</p>

<p>
If you open up the PSSW stare MSB in the heterodyne library, you will
see that it contains the same elements as the BMSW MSB, with the
exception of the "Chop" component. Opening the "Target Information"
component, however, reveals two rows in the bottom right hand window,
a SCIENCE and a REFERENCE row. Clicking on one of them allows the user
to specify the co-ordinates of either the SCIENCE, or "on" position,
or the REFERENCE or "off" position. The REFERENCE position can either
be specified as a co-ordinate offset from the SCIENCE position, by
checking the "offset" box, or as an absolute co-ordinate, by
leaving the "offset" box unchecked.
</p>

<p>
<b>Important</b>: If you put or leave a REFERENCE position in the
Target Component of a chopped observation (Stare-BMSW, Jiggle-Chop)
that position will be used when doing a three-load calibration
(hot-cold-sky).
</p>

<p>
For all stare modes, the <i>total</i> "on" integration time per
stare is indicated in the "Stare" eye. Note
that integration time no longer is the "on+off" time, only the "on"
time.
</p>

<h3 id="het_grid_folder">Grid Maps</h3>

<p>
Observations of a single science target at multiple positions are
generically referred to as Grid observations. Note that the user can
define any list of positions and that there is no requirement that the
pointings form a regularly shaped grid. Opening the various grid MSBs
in the heterodyne library shows they are similar to the Stare-PSSW or
Stare-BMSW MSBs except for the addition of an
<a href="#het_offset">Offset Iterator</a>. This iterator enables the user
to specify the required pointings for the observation.
</p>

<p>
Suppose you require three pointings along the long axis of a
galaxy, at a half beam width spacing of 10 arc-seconds. Let us assume
the long axis of the galaxy has a position angle of 30 degrees on the
sky. First enter the position angle in the "P.A." field. The rotated
frame has axes labeled "p" and "q", so in order to obtain the required
pointings along our galaxy we require (p,q) offsets of (0,-10), (0,0)
and (0,10).
You can add a new pointing by clicking on the "New"
button, and then modify the offsets via the "p" and "q" boxes directly
above the "New" button.
The highlighted pointing can be removed using
the "Remove" button. The "Rm. all" button removes all of the
user-added pointings. The arrow buttons to the right of the box
displaying the pointings allow the pointings to be re-ordered. The
highlighted pointing can be advanced one position up or down the
pointing list, or to the top or bottom of the list by clicking on
these arrow buttons. For our example, the completed "Offset" iterator
will appear as shown below.
</p>

<p>
<img src="het_images/het_offset2.png" alt="The Offset Iterator (2)" width="816" height="621" class="figure" />
</p>

<p>
If you want to see what the offsets are in the sky frame (which will
be the co-ordinate frame specified in the "target information"
element), click and hold the "Display Derotated Offsets" button.
</p>

<p>
The "Offset" iterator has the ability to automatically generate
regularly spaced grids without the need to enter each pointing
individually. The "Grid Pattern" section of the "Offset" iterator
allows the user to specify the offset of the top-left corner of the
grid (i.e. most positive 'p' and 'q'), the grid point spacing, and the
dimensions of the grid, in grid points. To create a 3x3 grid, with a
ten arc-second spacing, you would fill in the fields of the grid
pattern section as illustrated below, and then click on either
"Create/Center on Base" button, or the "Create" i.e. on corner
button. The pointings generated then appear in the pointing list box
above.
</p>

<p>
Notice that "Create/Center on Base" chooses the the geometrical center
of the grid for the (0,0) position, and ignores the contents of the
"initial offset" fields. The "Create" (on corner) button, on the other
hand, will place the top left pixel at the offset specified in the
"initial offset" fields.  For example, if you want a 2x2 grid with 10
arc-second spacing at offsets (0,0),(-10",0),(-10",-10"),(0,-10"), then
set the initial offsets to p=0,q=0, spacing p=10",q=10", and
dimensions 2x2, and click the "Create" button.
</p>

<p>
<img src="het_images/het_offset3.png" alt="The Offset Iterator (3)" width="821" height="632" class="figure" />
</p>

<h3 id="het_jig_folder">Jiggle Maps</h3>

<p>
Jiggle observations, like Grids, map a region around a source. This
mode is primarily intended for array instruments with widely spaced
receptors for which 'jiggling' is needed in order to achieve Nyquist
sampling. Nevertheless it is available for single-pixels receivers as
well.  As opposed to Grids, the secondary mirror is used to move
over the points in the pattern. This allows for a fast switching of
the position and makes it possible to observe the whole jiggle
pattern before going to the reference position.  (In "continuum mode",
however, where the chop frequency is much higher, half the time is
spent at the reference position.) Jiggle-chops are beam-switched
observations, and hence the distance to the sky reference can be no
more than 180". Jiggle-PSSW use a jiggle to maps the source, but a
position-switch to move to the reference.
</p>

<p>
Opening the various chop MSBs in the heterodyne library shows they are
similar to the Stare-BMSW example above except that there is a
"Jiggle" eye instead of the "Stare" eye. It offers various
jiggle patterns: 3x3 through 11x11 plus HARP-specific jiggles (such as
HARP4 and HARP5).
</p>

<p>
Since any spacing can be specified using the NxN patterns, in order to
<i>guarantee</i> that the target falls on one of the pixels in the
output map (as opposed to between e.g. widely spaced pixels), these
patterns are <i>receptor-centered</i>.  Four special patterns are also
available for making fully sampled maps with the HARP array receiver.
"HARP4" and "HARP4_mc" are 4x4 patterns with 7.5" pixels
designed to fill in the footprint, but slightly under Nyquist sampled,
whereas "HARP5" and "HARP5_mc" are 5x5 patterns with 6" pixels,
i.e. slightly better than Nyquist sampled.
</p>


<ul>
    <li>
        <p>
        HARP4 and HARP5 are <em>pixel-centered</em>: these will give you
        fully-sampled maps with the target position on one of the center 4
        pixels of the output map. The resulting map will be slightly
        asymmetric and maps observed at different time may have a different
        orientation. However, the affected area will only be a single-pixel
        wide rim along two or more edges of the map.
        </p>
    </li>
        <li>
        <p>
        HARP4_mc and HARP5_mc are <em>map-centered</em>: these will give
        you fully-sampled maps with the target position in the exact center of
        the output map, <i>between</i> the 4 central pixels. The resulting
        map will be symmetric around this position.
        </p>
    </li>
</ul>

<p>
For a more extensive discussion please see
<a href="#het_centering"> Centering the Observations</a> and the figures there.
</p>

<p>
For the NxN patterns the "Jiggle Spacing" needs to be defined by the
user: typically 0.5 or 1 beam-spacing in arc-seconds. The PA and System
should be left at "0.0" and "Tracking" for the typical user. Finally,
the integration time for each jiggle position can be specified as
"secs/jig posn". (Note that this is the total "on-source" time per
position.) As for the "Stare" eye, the estimated RMS noise per
channel is shown in the "Noise" box.
</p>

<p>
<img src="het_images/het_jiggle.png" alt="Jiggle-Chop" width="934" height="695" />

<p>
"Continuum mode" can be selected as is explained for the
<a href="#het_sample">"Stare" eye</a>. Due to the resulting
increase of the time needed to complete the observation, by a factor
of approximately 1.7, only check this if you really need the
measurement of the continuum level.
</p>

<p>
<b>Important</b>: If you put or leave a REFERENCE position in the
Target Component of a chopped observation (Stare-BMSW, Jiggle-Chop)
that position will be used when doing a three-load calibration
(hot-cold-sky).
</p>

<h3 id="het_rast_folder">Rasters &mdash; Classical (scan) &amp; Rasters &mdash; Basket Weave</h3>

<p>
Both Classical (scan) and Basket Weave raster scan folders can be found in the
<a href="generic.html#lib-acsis">ACSIS Library</a>.
</p>


<p>
<img src="het_images/het_raster.png" alt="The ACSIS Library" width="934" height="694" class="figure" />
</p>

<p>
The format of the position switched scan MSB is similar to the
sample MSB, except that the "Stare" eye is replaced by the
"Scan" eye. The fields in the "Area" panel allow you control
the size and sampling of the scan map. The resulting Nr. of
samples/pixels and Nr. of scans/pixels in each dimension is shown. The
total required on-source integration time per sample point can be specified in
the "Sample time" box.  The system will automatically break up the
observations into multiple passes over the map.
</p>

<p>
Setting up scan maps is significantly different when using a
<a href="#rxa_rast_example">non-array receiver</a> (i.e. RxA or RxW), or
an <a href="#harp_rast_example">array receiver</a> (i.e. HARP).
Please see the examples below for each type of receiver.
</p>

<h4 id="rxa_rast_example">Making a Scan Map With a Non-Array Receiver (RxA/RxW)</h4>

<p>
When using a single-pixel receiver such as RxA or RxW, the "sample
spacing" will be the pixel-size along scan direction of the
telescope. The "scan spacing" will be the pixel-size in the cross-scan
direction i.e. between the scanned rows. Be aware that there will be a
pixel centered on the base position only if the number of pixels in
each direction is odd. The size of the map <em>must</em> be a multiple
of the pixel-size in each direction, and is defined as the distance
between the <em>centers</em> of the outermost pixels!
</p>

<p>
Suppose, for example, that you want to use RxA to make a 238"x28"
map. A sample spacing of 7" and scan spacing of 7" will result in a
pixel map of 35x5. Note that it is customary to over-sample the
scan-direction to counter-act smearing, although this often requires a
re-gridding of the final map to recover the intended RMS/pixel.
</p>

<p>
<img src="het_images/het_scan.png" alt="Scans" width="946" height="645" class="figure" />
</p>

<p>
The sample time box allows the user to set the amount of time data is
taken for for each map "point" as the receiver is scanned across the
sky.  The RMS noise per channel of the final co-added map is also
indicated, as is the estimated time to complete each row and the
complete map.
</p>

<p>
It is possible to set the scanning direction, but for most purposes
this should be left to the default values.
</p>

<h4 id="harp_rast_example">Making a Scan Map With an Array Receiver (HARP)</h4>

<p>
HARP is a 4x4 square array of receptors, which are separated by 30".
To make a scan map, the telescope scans continuously along (by
default) the longest axis of the map (defined by the <em>width</em>
and <em>height</em> of the map).  The array is rotated by 14.04 degrees
to the direction of the scan.  This results in a fully sampled map,
with 7.3" pixels.  Thus the HARP <b>sample spacing</b> is set by the
OT to 7.2761".  At the end of a scan, the array is shifted up by the
<em>scan spacing</em> and the telescope makes another scan across the
area to be mapped.  A pull-down menu allows one to set the <em>scan
spacing</em>, so that one can step by the full array (i.e. no overlap
of pixels during subsequent scans), by 3/4 array, 1/2 array, 1/4
array, 1/8 array or by a single pixel (i.e. a shift of 7.28").
</p>

<p>
A comparison of rasters made with different scan spacings
is available at the following web page:
<a href="http://www.eaobservatory.org/jcmt/instrumentation/heterodyne/observing-modes/harp-rasters/">HARP Rasters</a>.
</p>

<p>
<img src="het_images/harp_scan.png" alt="HARP Scan" width="846" height="644" class="figure" />
</p>

<p>
Effectively the largest single map one can make is one square degree.
Larger maps can be made, but they should be broken up into smaller
pieces, one piece per MSB, with an offset iterator for each piece.
Note that mosaicking such large maps will likely tax most computing
systems beyond their capacities.
</p>

<p>
In the lower left panel of the "Scan" window, one can
specify the direction and orientation of the scan, using two pull-down
menus, <em>PA</em> and <em>System</em>.  For all but very special
applications, the <em>System</em> should be left in its default,
<em>TRACKING</em> coordinates (e.g. R.A./Dec.).  If <em>PA</em> is
left in its default state (<em>automatic</em>), then the telescope
will scan along the longest axis of the scan box defined by
<em>width</em>, <em>height</em>, and <em>PA</em> specified in the
<em>Area</em> panel.  One can, however, set the scan direction to any
arbitrary value, by selecting <em>user def</em> from the <em>PA</em>
pull-down menu, and typing in the required scan direction in degrees,
where PA=0 is north and PA=90 is east.
</p>

<p>
If the scan map is to be repeated, a useful technique is to "basket
weave" the scans, i.e. make a scan map by scanning along one axis of
the map, and then repeat by scanning along the other axis.  This
minimizes striping in the resultant map. One way to do this is to edit
a science observation for a scan map, set the parameters as
required, then copy the entire science observation and paste the copy
below the original.  In the original "Scan" eye, set the
<em>SCAN PA</em> (lower left panel) to <em>Along Width</em>. Do the same in the
copied "Scan" eye, but set the <em>SCAN PA</em> to <em>Along Height</em>.
</p>

<p>
<em>Sample Time</em>: The <em>sample time</em> is the total
integration time <i>per pixel</i> in the completed map.  The minimum
time depends on the setup of the backend. It is about 0.3 seconds with
8192 channels (e.g. single 250 MHz band), but can be as low as 0.1
second with 2048 channels.  There is no physical limit for the maximum
sample time. However, it should be noted that the telescope does not
check the reference position until at least one row is completed.
Thus one should make sure that the total time per row is less than
about 60 seconds (or 120 seconds under stable weather conditions), and
the total time for the MSB is no more than 1.5 to 2 hours at most.
For large maps the integration time per pixel (<em>sample time</em>)
should be set to a small value, e.g. 0.3 seconds per pixel, and then
repeat the MSB to build up integration time.
</p>






<h2 id="het_adv">Advanced Heterodyne Topics</h2>


<h3 id="het_freq_ed">The Frequency Editor</h3>

<p>
Clicking on the "Show Frequency Editor" button
in the <a href="#het_thsc">"Het Setup" component</a> will show you something like
this:
</p>

<p>
<img src="het_images/het_frequency_editor.png" alt="Het Freq Editor" width="853" height="275" class="figure" />
</p>

<p>
The frequency editor tool is particularly useful when trying to configure the
backend for multiple lines, multiple resolution windows, or for receivers
operating in dual sideband mode, where two differing sky frequencies end
up with the same IF frequency. In each of these cases finding the correct
values for the setup of each window is tricky and the visual presentation
from the frequency editor is indispensable, if only to verify the setup.
The tool now handles multi-spectral window selection and can be used
interactively in choosing observing frequencies and bandwidths for each
window or in combination with
<a href="./het_sp_config.html"> special ACSIS configurations</a>,
or simply to check the atmospheric opacity at the observed (or sideband)
frequency. Before clicking the 'Show Frequency Editor' button, please make
sure to select the desired number of spectral windows under 'Sp. Regions'
(See above). Once inside the frequency editor, the frequencies and bandwidths
can be selected or adjusted.
</p>

<p>
Working roughly from top to bottom, left to right, in the example above
showing only one Spectral Subsystem (USB) with two spectral windows,
we see:
</p>

<ul>
    <li>
        The observing and image side-bands, marked as <b>LSB</b> and <b>USB</b>.
    </li>
    <li>
        Their locations within the respective LO2 ranges and their widths.
    </li>
    <li>
        The identification of the selected emission line associated with a window,
        marked <b>Line</b>.
    </li>
    <li>
        The <b>IF</b> (Intermediate Frequency), sometimes in Hz sometimes GHz.
    </li>
    <li>
        The bandwidth, in MHz.
    </li>
    <li>
        The <b>Res</b>olution that the selected bandwidth produces, in kHz.
    </li>
    <li>
        The molecular transitions in this vicinity, marked by vertical bars,
        on a line labeled <b>Emission Lines</b>.
    </li>
    <li>
        The frequency scale immediately below Emission Lines is the frequency
        in the rest frame of the source i.e. the emission lines show at their
        nominal laboratory frequency regardless of the doppler shift.
    </li>
    <li>
        The line selected is shown in <span style="color: red;">red</span>.
    </li>
    <li>
        The receiver temperature
        (<span style="color: red;">TRx</span>) is plotted as the
        <span style="color: red;">red</span> line (although there
        is no scale currently). It's wise to check this since even a minor
        change in radial velocity can shift the observed frequency into a
        region of very large atmospheric opacity.
    </li>
    <li>
        The <b>FE Freq</b>uency scale, shown below the plot of TRx
        is the observing frequency in the rest frame of the receiver i.e.
        the tuning frequency at the telescope.
        You will notice this scale will shift if you enter a non-zero
        velocity, and will also shift if you change the velocity
        definition.
    </li>
    <li>
        The Local Oscillator frequency, shown as <b>LO1</b>, located within
        the full tuning range of the receiver.
        <ul>
            <li>
                Note the upper frequency scale, lower frequency scale and LO1 are only
                approximate because the correction from the receiver rest frame to the
                chosen rest frame requires the Doppler correction for the Earth's
                motion, which varies with time.
            </li>
        </ul>
    </li>
</ul>

<p>
Among the dynamic functions, we find that:
</p>

<ul>
    <li>
        The positions of the windows can be changed by
        clicking on the window sliders and dragging.
        Note how the LO1
        and LO2 (ie the IF) both change.
    </li>
    <li>
        The bandwidth can be changed by clicking on the pull-down menu.
    </li>
    <li>
        Clicking anywhere along the 'Emission lines' level will identify
        the nearby lines.
    </li>
    <li>
        Keeping the mouse button depressed while scrolling
        down through the menu makes the line appear in
        <span style="color: green;">green</span>.
    </li>
    <li>
        The LO1 frequency can be changed by right-clicking on the slider and
        dragging. This changes both frequency scales and the line rest frequency.
        Moving the LO slider can be a convenient means of choosing a band center
        frequency such that particular spectral lines are included or excluded
        from your pass-band.
    </li>
</ul>

<p>
<img src="het_images/het_frequency_editor2.png" alt="Het Freq Editor2" width="846" height="321" class="figure" />
</p>

<p>
The above example shows a setup with three 250 MHz windows and one, lower
resolution, 1000 MHz window for receiver A (for HARP only two windows are
possible). Of the 250 MHz windows, one is centered on a line in the LSB, two
on lines in the USB. The line identifier for the top window is greyed out because it
corresponds to the observing frequency specified in the main Het. Setup
component and it 'anchors' all windows. Moving the slider of the top window
will also slide all other windows. By contrast the remaining three windows
can be moved independently from one another within the IF band.
</p>

<p>
To generate such a multi-line, multi-Subsystem configuration:
</p>

<ul>
    <li>
        In the Front-End configuration window, select a value of Sp.(ectral)
        regions greater than 1.
        The Frequency Configuration block at the bottom of the screen will show
        the appropriate number of 'Region's, although initially they
        are populated with default values.
    </li>
    <li>
        Select the first line (for Region 0) as above.
    </li>
    <li>
        Press the Frequency Editor button to generate a Frequency Editor
        window with the appropriate number of Subsystems. The pre-selected
        line is in <span style="color: red;">red</span>.
    </li>
    <li>
        <b>Click</b> at the level of 'Emission Lines' in the general vicinity
        (frequency space) of the next desired line.
    </li>
    <li>
        Keep the button pressed and scroll down until the line is met,
        and shown in <span style="color: green;">green</span>.
    </li>
    <li>
        Click on the 'Line' box appropriate for that subsystem to center the
        spectral window and identify it with the selected line.
    </li>
    <li>
        Repeat (from <b>Click</b>) for further lines if necessary.
    </li>
    <li>
        Press the Hide Frequency Editor button to transfer these data to the
        Heterodyne Setup window.
    </li>
</ul>

<p>
Note that the movement of the sliders will make for
configurations that may not be easily repeatable and that use of
the <i>'Special Configurations'</i> is desirable.
If you have a multi-line configuration that you consider
astrophysically important &mdash; and which may be useful for either
yourself or others later on &mdash; please contact the JCMT staff
and request that it become one of the available 'Special
Configs'. Our (<a href="http://www.cadc-ccda.hia-iha.nrc-cnrc.gc.ca/">CADC</a>)
database will then be a lot simpler to manage and search if everyone
using this combination of lines uses precisely the same configuration.
</p>

<p>
<b>Note:</b> Please make sure that the window is
anchored on a line if it is intended to be centered on that
line. While the observation will proceed with a <i>'no line'</i>
label, the line identification is important for archival purposes.
</p>




<h2 id="het_tpe">The Position Editor</h2>

<p>
You can <a href="#velocities">skip</a> this section if you want because
you don't have to use the position editor, but it can be very
useful, for example in picking a good chop position. Click on the "Plot" button at
the bottom left of the <a href="#het_tcc">"Target Information" component</a>:
</p>

<p>
A whole new window will pop up &mdash; this is the position editor. Looks a
bit boring at the moment though, with just a small green cross-hair in
the middle. Let's make it a bit more interesting &mdash; go to Catalog menu
and into the Image Servers item and chose a Digital Sky Survey near
near you:
</p>

<p>
<img src="het_images/het_tpe.png" alt="The Position editor" width="661" height="722" class="figure" />
</p>

<p>
It's now full of stars. The display application, by the way, is
based on JSky, for those familiar with it.
</p>

<p>
If you're having problems with the position editor, the most likely
explanation is that your version(s) of JRE, JAI and/or Java may not be
sufficiently up-to-date; check the
<a href="http://www.eaobservatory.org/jcmt/observing/software-installation/">software installation page</a>
for more information.
If you are behind a firewall, you may
need to check your
<a href="advanced.html#proxy">proxy server settings</a>.
</p>

<p>
The DSS may not be the most useful survey for planning sub-millimeter
observations, but you can read in any FITS image with an appropriate
WCS header using Open under the File menu. You can also fetch a FITS
image over the Web. The screen shot below shows the SCUBA commissioning
scan map of W48 <em>(image courtesy Tim Jenness)</em>. If you have an
Internet connection, go to the File menu, select "Open URL...:" and
type in the following URL:
<a href="http://www.eaobservatory.org/JCMT/observing-tool/example/w48.fits">
http://www.eaobservatory.org/JCMT/observing-tool/example/w48.fits</a>
or download the image by clicking on the link and and use
File&#x2192;Open to read it in. Notice that the RA/DEC position fields of
the target component must be set reasonably near to the world
co-ordinate of the FITS file otherwise the image may not load
properly.
</p>

<p>
<img src="images/w48.png" alt="W48" width="603" height="469" class="figure" />
</p>

<p>
You will then see the DSS image replaced with the sub-millimeter
image.
</p>

<blockquote>
    <p>
    A short technical note if you are planning on generating your own
    image for import: if you want to import a SCUBA map in NDF format,
    convert it to FITS by using the
    <a href="http://www.starlink.ac.uk">Starlink</a>
    <a href="http://www.starlink.rl.ac.uk/star/docs/sun55.htx/sun55.html">convert</a>
    utility with the following arguments:
    </p>

    <pre>
    ndf2fits encoding=FITS-IRAF bitpix=32 comp=D
    </pre>

    <p>
    If you have difficulty despite doing this, let us know.
    </p>
</blockquote>

<p>
As was mentioned before, the green cross-hair is the position of your
science co-ordinates. Click on the button on the left side of the
position editor entitled "Sci Area". The circle that is drawn is the
HPBW of the chosen heterodyne receiver.
</p>

<p>
Now for the useful thing mentioned earlier: While leaving the position
editor window open, go back to your science program window and click
on your chop iterator that is inside your science observation. Now
look at the position editor. The chop beams and the area in which they
will rotate during integration are drawn. Well, that's no good &mdash; we're
chopping onto bright stuff!
</p>

<p>
<img src="het_images/het_bright_chop.png" alt="bright stuff" width="661" height="722" class="figure" />
</p>

<p>
This is where the position editor comes into its own. We are going to
use it to specify where exactly we would like to chop. In the chop
iterator, use the drop down menu to change the chopping co-ordinate
frame from AZEL to TRACKING (i.e. RA/DEC). You will notice that in the
position editor the uncertainty circles have disappeared, since we
will always chop in the same position in the sky:
</p>

<p>
<img src="het_images/het_tracking_chop.png" alt="Chop and the Position Editor" width="749" height="901" class="figure" />
</p>

<p>
Now back in the position editor, click on the Drag button on the upper
left side of the window. Then click on the center of one of the chop
beams in the display and drag it away from the emission:
</p>

<p>
<img src="het_images/het_tracking_chop2.png" alt="Dragging the Chop" width="672" height="880" class="figure" />
</p>

<p>
You will note that the values in the chop iterator have automatically
changed to reflect the new chop throw and angle values.
Remember that by default, any calibrations for your observations will
be performed with the same chop as the science observation.
</p>

<p>
You can also click on the target component and use Drag to change your
science co-ordinates if you wish.
</p>


<h3 id="velocities">Velocities: The Het Setup and Target Component</h3>

<p>
It used to be that the receiver tuning, including the source velocity,
were specified in the Heterodyne Component while the source
coordinates needed to be entered in the Target Component. Half of our
observers were very happy with this, since they preferred to observe
all their sources with the same receiver setup. The other half of the
observers complained bitterly since they wanted to be able to read in
the sources <em>and</em> velocities from a catalog and center the
bandpass for each.
</p>

<p>
Hence the OT now allows for the observing velocity to the specified
in the Heterodyne Component <em>or</em> the Target Component. But this
has made life a bit more complicated.
</p>

<p>
The description of the
<a href="het_example.html#het_thsc">Heterodyne Setup component</a>
should have made it clear that it uses the
velocity to compute the approximate sky frequency as a check whether
the line falls within the tuning range, to show the setup in the
frequency editor etc. However, it can <em><b>only</b></em> do that if
it has access to the velocity information. In the case where the
velocity information
has been put in the Target Component, this <em>requires</em> the components
to be at the same level of indentation. If this is not the case, the
Het. Component will assume a velocity of 0 km/s.
</p>

<p>
<em>Note that is only a problem within the OT: when MSBs are submitted
for observation the tree structure from the OT is unrolled and for
each observation the appropriate Het Setup and Target Component are
paired up.</em>
</p>

<p>
In general, this is not a problem for Galactic sources since the
overall parameters of the observation of a molecular line (center
frequency, atmospheric transparency, receiver characteristics) don't
significantly differ from source to source. That of course may not be
the case for extra-galactic and high-z sources: vary the velocity or
red-shift enough and the line may shift completely out of the band or
into an atmospheric absorption line for some of the sources (it has
happened!). The "Het Setup" component will notify you of (un)available
transitions for a particular molecule and the Frequency Editor will
show the transmission at the observing frequency, but only if it
can find the velocity of the observation.
</p>

<p>
<small>Small print: which is one of the reasons that we advice to
always select a 'Molecule' and 'Transition' from the drop-down
list, rather than typing a frequency manually.</small>
</p>

<p>
In summary, the following sample layouts allow for the Het. Component
to obtain the velocity from the Target Component:
</p>

<pre>
    *MSB                           *MSB                           *AND
      o Het Setup                    o Site Quality                 o Het Setup
      o Site Quality                 o Observation                  o Site Quality
      o Target Information             - Het Setup                  o Target Information
      o Observation                    - Target Information         o MSB1
        - Sequence                     - Sequence                     - Observation
           ...                            ...                            + Sequence
                                                                           ...
                                                                    o MSB2
                                                                           ...
</pre>

<p>
In the following samples the Het. Setup will <em>not</em> be able to access the velocity:
</p>

<pre>
    *MSB                           *MSB                           *AND
      o Het Setup                    o Site Quality                 o Het Setup
      o Site Quality                 o Target Setup                 o Site Quality
      o Observation                  o Observation                  o MSB1
        - Target Information           - Het Setup                    - Target Information
        - Sequence                     - Sequence                     - Observation
           ...                            ...                              ...
                                                                    o MSB2
                                                                      -  Target Information
                                                                             ...
</pre>


<h2 id="het_cal">Calibrations</h2>

<p>
The JCMT telescope
operators will insert calibrations, pointings, foci, etc. into
the observing sequence as appropriate.  Without any specific
instructions in the science program calibrations will be carried out
by observing a 'standard' line in a suitable calibration source.
</p>

<p>
PIs are strongly advised to, at a minimum, add instructions and wishes
regarding calibrations in the <i>Calibration Note</i> to the telescope operators and
observers. A sample note has been included with the library templates.
For information on standard sources, lines, and observational setup, please see
<a href="http://www.eaobservatory.org/jcmt/instrumentation/heterodyne/calibration/">
JCMT Heterodyne Standards</a>.
<em>Please be aware that the sub-mm positions for calibrators as used
at the JCMT may differ substantially from the the ones in archives
such as SIMBAD.</em>
</p>

<p>
There are several options for calibrations and ways to customize them:
</p>

<ol>
    <li>
        <p>
        No special calibration MSBs provided in the Science Program.
        </p>

        <ul>
            <li>
                <p>
                The calibrations will be carried out on a suitable calibration source
                selected by the telescope operator at a 'standard' frequency, possibly different from
                MSB tuning or redshift. For many applications, this is the most
                appropriate option.
                </p>
            </li>
        </ul>
    </li>

    <li>
        <p>
        A number of separate calibration MSBs on suitable targets
        included in the science program.
        </p>

        <ul>
            <li>
                <p>
                These MSBs must be clearly identified as calibrations in
                their title. Typically the set of calibration MSBs should cover the
                RA-range of the science observations to ensure that at least one
                calibration MSB is available at any time.  PIs can customize the
                "Het Setup" component but need to take care to pick an appropriate
                switching scheme for each calibrator chosen.  The telescope operator will insert the
                calibration MSBs into the observing queue as needed and per
                instruction in the science program.
                </p>
            </li>
            <li>
                <p>
                The ACSIS library has a set of special template MSBs for a
                position-switched, beam-switched, or scan calibration. The MSBs start
                with a series of (optional) pointing and focus observations. The
                calibration itself is a regular observation that has been marked as a
                calibration.  Configure the "Het Setup" and
                "Target Information" components to customize the calibration for your project.
                Typically choose either a position-switched, beam-switched,
                or scan calibration,
                depending on the selected calibration target (many of which require a
                position switch).  Observational details for the calibrators can be
                found on the
                <a href="http://www.eaobservatory.org/jcmt/instrumentation/heterodyne/calibration/">
                JCMT Heterodyne Standards</a> page.  The calibration MSBs should be added
                to the science program with a high priority (low number) and high
                repeat counter to ensure that they will come up prominently and
                repeatedly in the JCMT Query Tool.
                </p>
            </li>
        </ul>
    </li>

    <li>
        <p>
        Calibration observations as part of the science MSBs.
        </p>

        <ul>
            <li>

                <p>
                Embed the calibration observation of a specific standard source
                and line in your science MSB by copying and pasting the desired
                components from the calibration template described above under
                option 2 (please read those instructions). The MSB should look like:
                </p>

<pre>
    -------------------------
    MSB
     ...
     Het setup
     Science Target
     <span style="color: green;">Calibration Observation (marked as Calibration)</span>
     Science Observation
    -------------------------
</pre>

                <p>
                Please be aware of <i>inheritance</i>: in the example above you will need to
                add another "Target Information" component inside calibration observations with the
                coordinates and offsets of the calibrator! Likewise, if the
                calibration needs to be done at a different frequency, another
                "Het Setup" component needs to be added inside the Calibration Observation. This will
                result in the appropriate re-tune between the calibrator and the
                science target. This should not be done for the manually tuned
                RxW. <b>WARNING:</b> If you include a calibration observation in this manner,
                both your target and calibration source must be observable before the
                MSB can be scheduled, which can severely restrict the night-time
                available to the project in case of an unfortunate combination of
                calibration and science targets.
                </p>
            </li>
        </ul>
    </li>
</ol>


<p>
Issues to consider regarding calibrations may be:
</p>

<ul>
    <li>
        <p>How important is a precise calibration? For many projects it is
        sufficient to ensure that the telescope and receiver are operating within
        their specifications.
        </p>
    </li>

    <li>
        <p>
        Can the calibration be done at a 'standard' frequency, possibly
        different from MSB tuning or redshift? Or should the calibration be
        done with the "Het Setup" component of the science observation and, if not
        close to a standard frequency, should a line-rich source be selected
        that will allow for the relative calibration of observations from
        night to night?
        </p>
    </li>

    <li>
        <p>
        Can the calibration be done using a different bandwidth than the
        science observation? Is an increase in bandwidth allowed to catch
        a nearby standard line? Increasing the bandwidth should not affect the
        calibration, except that the peak of very narrow lines will drop
        because of the lower resolution.
        </p>
    </li>

    <li>
        <p>
        Is it important to observe a planet? Can this be done at one of
        the standard frequencies or should the "Het Setup" component from the
        science MSB be used?  Efficiencies derived from isolated observations
        of the continuum level of planets are typically not very
        accurate.
        </p>
    </li>
</ul>


<h2 id="het_rotator">Rotator Angles</h2>

<p>
When you observe with HARP, the telescope control system will
select the array orientation from a series of allowed
angles with respect to the area being mapped.
For jiggle and grid (including stare) observations,
the array could normally be oriented at
0, 90, 180 or 270 (-90) degrees to your map area.
</p>

<p>
If your program requires that you control the orientation of the
HARP array, you can use the "Rotator Angles" checkboxes
on the Jiggle or Stare panel.
If you select any angles here, then the TCS will choose
from the angles you have selected.
Otherwise &mdash; if you leave all of the angles unselected &mdash;
the observing sofware will automatically
generate a list of possible angles.
</p>

<p>
For more information about the HARP K-mirror, please see the
<a href="http://www.eaobservatory.org/jcmt/instrumentation/heterodyne/harp/k-mirror/">
HARP K-mirror information page</a>.
</p>

<p>
<img src="het_images/het_rotator.png" alt="Selection of rotator angles" width="939" height="570" class="figure" />
</p>


<nav>
<a href="index.html">&#x2190; JCMT OT Primer Main Page</a>
</nav>
</body>
</html>
